(()=>{"use strict";var e,o={29:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.clamp=o.onKeyUp=o.onKeyDown=o.sensibility=void 0;const n=t(1088);o.sensibility=.8,o.onKeyDown=function(e){let o=e.code||e.key;"ArrowLeft"===o||"KeyA"===o?n.sceneConfiguration.leftPressed=!0:"ArrowRight"!==o&&"KeyD"!==o||(n.sceneConfiguration.rightPressed=!0)},o.onKeyUp=function(e){let o=e.code||e.key;"ArrowLeft"===o||"KeyA"===o?n.sceneConfiguration.leftPressed=!1:"ArrowRight"!==o&&"KeyD"!==o||(n.sceneConfiguration.rightPressed=!1)},o.clamp=(e,o,t)=>Math.min(Math.max(e,o),t)},1088:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.sceneSetup=o.sceneConfiguration=o.water=o.waterGeometry=o.camera=o.scene=void 0;const n=t(5824),r=t(8509),a=t(5968),i=t(9264),s=t(29),l=t(9572),c=t(8820),d=t(3276);o.scene=new n.Scene,o.camera=new n.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,2e3);const u=new n.Vector3;let m,p=0;o.waterGeometry=new n.PlaneGeometry(1e4,1e4),o.water=new c.Water(o.waterGeometry,{textureWidth:512,textureHeight:512,waterNormals:(new n.TextureLoader).load("static/normals/waternormals.jpeg",(function(e){e.wrapS=e.wrapT=n.MirroredRepeatWrapping})),sunDirection:new n.Vector3,sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:void 0!==o.scene.fog}),o.sceneConfiguration={ready:!1,cameraMovingToStartPosition:!1,rocketMoving:!1,data:{crystalsCollected:0,shieldsCollected:0},courseProgress:0,levelOver:!1,level:1,cameraStartAnimationPlaying:!1,backgroundRockCount:0,challengeRowCount:0,speed:0,dieLeft:Math.random()>.5,starterBayInScene:!1,leftPressed:!1,rightPressed:!1},o.sceneSetup=e=>{p=0,o.sceneConfiguration.challengeRowCount=0,o.sceneConfiguration.backgroundRockCount=0,o.scene.add(a.starterBay),o.sceneConfiguration.starterBayInScene=!0,a.starterBay.position.copy(new n.Vector3(10,0,120)),a.rocketModel.rotation.x=Math.PI,a.rocketModel.rotation.z=0,a.rocketModel.position.z=70,a.rocketModel.position.y=10,a.rocketModel.position.x=0,a.challengeRows.forEach((e=>{o.scene.remove(e.rowParent)})),a.environmentRocks.forEach((e=>{o.scene.remove(e)})),a.environmentRocks.length=0,a.challengeRows.length=0;for(let e=0;e<60;e++)(0,a.addChallengeRow)(o.sceneConfiguration.challengeRowCount++),(0,a.addBackgroundRock)(o.sceneConfiguration.backgroundRockCount++);o.sceneConfiguration.cameraStartAnimationPlaying=!1,o.sceneConfiguration.levelOver=!1,a.rocketModel.userData.flyingAway=!1,o.sceneConfiguration.courseProgress=0,o.sceneConfiguration.data.shieldsCollected=0,o.sceneConfiguration.data.crystalsCollected=0,i.crystalUiElement.innerText=String(o.sceneConfiguration.data.crystalsCollected),e?(0,i.animateCameraFromEndToStartPosition)():(o.camera.position.z=50,o.camera.position.y=12,o.camera.position.x=15,o.camera.rotation.y=2.5),o.sceneConfiguration.ready=!0};const f=()=>{var e,t,r,i,c,u,v,h;if(requestAnimationFrame(f),o.sceneConfiguration.ready){if(null===(t=null===(e=a.rocketModel.userData)||void 0===e?void 0:e.mixer)||void 0===t||t.update(a.rocketModel.userData.clock.getDelta()),null===(i=null===(r=o.camera.userData)||void 0===r?void 0:r.mixer)||void 0===i||i.update(null===(u=null===(c=o.camera.userData)||void 0===c?void 0:c.clock)||void 0===u?void 0:u.getDelta()),l.destructionBits.forEach((e=>{var o;null===(o=e.userData.mixer)||void 0===o||o.update(e.userData.clock.getDelta())})),null===(h=null===(v=null===l.destructionShield||void 0===l.destructionShield?void 0:l.destructionShield.userData)||void 0===v?void 0:v.mixer)||void 0===h||h.update(l.destructionShield.userData.clock.getDelta()),o.sceneConfiguration.cameraStartAnimationPlaying||(o.camera.position.x=20*Math.cos(p),o.camera.position.z=20*Math.sin(p),o.camera.position.y=30,o.camera.lookAt(a.rocketModel.position),p+=.005),o.sceneConfiguration.rocketMoving&&!o.sceneConfiguration.levelOver){let e=0,t=0;o.sceneConfiguration.leftPressed&&(e-=s.sensibility,t-=Math.PI/4),o.sceneConfiguration.rightPressed&&(e+=s.sensibility,t+=Math.PI/4),a.rocketModel.position.x+=e,a.rocketModel.position.x=(0,s.clamp)(a.rocketModel.position.x,-20,25),t=-20===a.rocketModel.position.x||25===a.rocketModel.position.x?0:t,a.rocketModel.rotation.z=n.MathUtils.lerp(a.rocketModel.rotation.z,t,.1),o.sceneConfiguration.speed+=.001,o.sceneConfiguration.speed=(0,s.clamp)(o.sceneConfiguration.speed,0,10),o.sceneConfiguration.courseProgress+=o.sceneConfiguration.speed,(0,l.detectCollisions)(),(0,d.garbageCollector)()}(0,a.objectsMotionUpdate)()}(0,l.updateDestructionBits)(),(0,a.updateWaterMaterial)(),m.render(o.scene,o.camera)};(0,a.objectsInit)().then((e=>{(0,i.uiInit)(),async function(){var e,t,l;m=new n.WebGLRenderer,m.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(m.domElement),i.startPanel.classList.remove("hidden"),document.addEventListener("keydown",s.onKeyDown,!1),document.addEventListener("keyup",s.onKeyUp,!1),null===(e=document.getElementById("loadingCover"))||void 0===e||e.remove(),null===(t=document.getElementById("loadingTextContainer"))||void 0===t||t.remove(),null===(l=document.getElementById("rocketPicture"))||void 0===l||l.remove(),o.water.rotation.x=-Math.PI/2,o.water.rotation.z=0,o.scene.add(o.water);const c=new r.Sky;c.scale.setScalar(1e4),o.scene.add(c);const d=c.material.uniforms;d.turbidity.value=10,d.rayleigh.value=2,d.mieCoefficient.value=.005,d.mieDirectionalG.value=.8;const p=new n.PMREMGenerator(m),f=n.MathUtils.degToRad(87),v=n.MathUtils.degToRad(115);u.setFromSphericalCoords(1,f,v),c.material.uniforms.sunPosition.value.copy(u),o.water.material.uniforms.sunDirection.value.copy(u).normalize(),o.scene.environment=p.fromScene(c).texture,o.water.material.uniforms.speed.value=0,a.rocketModel.scale.set(.3,.3,.3),o.scene.add(a.rocketModel),o.scene.add(a.mothershipModel),a.mothershipModel.position.y=200,a.mothershipModel.position.z=100,a.mothershipModel.scale.set(15,15,15)}(),(0,o.sceneSetup)(!1),f()}))},3276:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.garbageCollector=void 0;const n=t(1088),r=t(5968);o.garbageCollector=()=>{let e=r.environmentRocks.filter((e=>e.position.z>100)),o=r.challengeRows.filter((e=>e.rowParent.position.z>100));for(let o=0;o<e.length-1;o++){let t=r.environmentRocks.indexOf(e[o]);n.scene.remove(r.environmentRocks[t]),r.environmentRocks.splice(t,1)}for(let e=0;e<o.length-1;e++){let t=r.challengeRows.indexOf(o[e]);n.scene.remove(o[e].rowParent),r.challengeRows.splice(t,1)}}},5213:(e,o,t)=>{t.d(o,{A:()=>n});const n="uniform sampler2D mirrorSampler;\nuniform float alpha;\nuniform float time;\nuniform float size;\nuniform float distortionScale;\nuniform float speed;\nuniform sampler2D normalSampler;\nuniform vec3 sunColor;\nuniform vec3 sunDirection;\nuniform vec3 eye;\nuniform vec3 waterColor;\n\nvarying vec4 mirrorCoord;\nvarying vec4 worldPosition;\n\nvec4 getNoise( vec2 uv ) {\n    float offset;\n    if ( speed == 0.0 ) {\n        offset = time / 10.0;\n    } else {\n        offset = speed;\n    }\n\n    // vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);\n    // vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );\n    // vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );\n    // vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );\n    vec2 uv3 = uv / vec2(50.0, 50.0) - vec2(speed / 1000.0, offset);\n    vec2 uv0 = vec2(0, 0);\n    vec2 uv1 = vec2(0, 0);\n    vec2 uv2 = vec2(0, 0);\n    \n    vec4 noise = texture2D( normalSampler, uv0 ) +\n        texture2D( normalSampler, uv1 ) +\n        texture2D( normalSampler, uv2 ) +\n        texture2D( normalSampler, uv3 );\n    return noise * 0.5 - 1.0;\n}\n\nvoid sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {\n    vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );\n    float direction = max( 0.0, dot( eyeDirection, reflection ) );\n    specularColor += pow( direction, shiny ) * sunColor * spec;\n    diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;\n}\n\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n    #include <logdepthbuf_fragment>\n    vec4 noise = getNoise( worldPosition.xz * size );\n    vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );\n\n    vec3 diffuseLight = vec3(0.0);\n    vec3 specularLight = vec3(0.0);\n\n    vec3 worldToEye = eye-worldPosition.xyz;\n    vec3 eyeDirection = normalize( worldToEye );\n    sunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );\n\n    float distance = length(worldToEye);\n\n    vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;\n    vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );\n\n    float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );\n    float rf0 = 0.3;\n    float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );\n    vec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;\n    vec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);\n    vec3 outgoingLight = albedo;\n    gl_FragColor = vec4( outgoingLight, alpha );\n\n    #include <tonemapping_fragment>\n    // #include <colorspace_fragment>\n    #include <fog_fragment>\t\n}"},5968:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ObjectType=o.addChallengeRow=o.addBackgroundRock=o.updateWaterMaterial=o.objectsMotionUpdate=o.objectsInit=o.shieldModel_transparent=o.shieldModel=o.rockModel=o.crystalModel=o.cliffsModel=o.mothershipModel=o.starterBay=o.rocketModel=o.challengeRows=o.environmentRocks=void 0;const n=t(5824),r=t(1088),a=t(7888);o.environmentRocks=new Array,o.challengeRows=new Array;const i=new a.GLTFLoader;o.objectsInit=async()=>{o.cliffsModel=(await i.loadAsync("static/models/cliffs/scene.gltf")).scene.children[0],o.crystalModel=(await i.loadAsync("static/models/glowing_crystals/scene.gltf")).scene.children[0],o.rockModel=(await i.loadAsync("static/models/glowing_rock/scene.gltf")).scene.children[0],o.shieldModel=(await i.loadAsync("static/models/shield_item/scene.gltf")).scene.children[0],o.rocketModel=(await i.loadAsync("static/models/rocket/scene.gltf")).scene.children[0],o.starterBay=(await i.loadAsync("static/models/start_bay/scene.gltf")).scene,o.mothershipModel=(await i.loadAsync("static/models/spaceship_nortend/scene.gltf")).scene,o.shieldModel_transparent=o.shieldModel.clone(),o.shieldModel_transparent.traverse((e=>{if(e instanceof n.Mesh){const o=e.material;if(o&&"transparent"in o&&"Material.001"!==o.name){e.material=o.clone();const t=e.material;t.transparent=!0,t.opacity=.2}else e.parent&&e.parent.remove(e)}}))},o.objectsMotionUpdate=()=>{o.environmentRocks.forEach((e=>{e.position.z+=r.sceneConfiguration.speed})),o.environmentRocks[0].position.z>-1300&&(0,o.addBackgroundRock)(r.sceneConfiguration.backgroundRockCount++,!0),o.challengeRows.forEach((e=>{e.rowParent.position.z+=r.sceneConfiguration.speed})),o.challengeRows[0].rowParent.position.z>-1300&&(0,o.addChallengeRow)(r.sceneConfiguration.challengeRowCount++,!0),r.sceneConfiguration.starterBayInScene&&(o.starterBay.position.z+=r.sceneConfiguration.speed,o.starterBay.position.z>200&&(r.scene.remove(o.starterBay),r.sceneConfiguration.starterBayInScene=!1))},o.updateWaterMaterial=function(){r.water.material.uniforms.time.value+=1/60,r.sceneConfiguration.rocketMoving?r.water.material.uniforms.speed.value+=r.sceneConfiguration.speed/50:r.water.material.uniforms.speed.value>0&&(r.water.material.uniforms.speed.value-=.001)},o.addBackgroundRock=(e,t=!1)=>{let a=t?-1400:-60*e,i=o.cliffsModel.clone();i.scale.set(.02,.02,.02),i.position.set(e%2==0?60-Math.random():-60-Math.random(),0,a),i.rotation.set(n.MathUtils.degToRad(-90),0,Math.random()),r.scene.add(i),o.environmentRocks.unshift(i)},o.addChallengeRow=(e,t=!1)=>{let a=t?-1400:-60*e,i=new n.Group;i.position.z=a;for(let e=0;e<5;e++){const o=10*Math.random();if(o<2){let o=s(e);i.add(o)}else if(o<4){let o=l(e);i.add(o)}else if(o>9){let o=c(e);i.add(o)}}o.challengeRows.unshift({rowParent:i,index:r.sceneConfiguration.challengeRowCount++}),r.scene.add(i)};const s=e=>{let t=o.crystalModel.clone();return t.position.x=11*e-20,t.scale.set(.02,.02,.02),t.userData.objectType=d.CRYSTAL,t},l=e=>{let t=o.rockModel.clone();return t.position.x=11*e-20,t.scale.set(5,5,5),t.position.setY(5),t.userData.objectType=d.ROCK,t},c=e=>{let t=o.shieldModel.clone();return t.position.x=11*e-20,t.position.y=8,t.userData.objectType=d.SHIELD_ITEM,t};var d;!function(e){e[e.ROCK=0]="ROCK",e[e.CRYSTAL=1]="CRYSTAL",e[e.SHIELD_ITEM=2]="SHIELD_ITEM"}(d=o.ObjectType||(o.ObjectType={}))},8047:(e,o,t)=>{t.d(o,{A:()=>n});const n="uniform mat4 textureMatrix;\nuniform float time;\n\nvarying vec4 mirrorCoord;\nvarying vec4 worldPosition;\n\n#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n\nvoid main() {\n    mirrorCoord = modelMatrix * vec4( position, 1.0 );\n    worldPosition = mirrorCoord.xyzw;\n    mirrorCoord = textureMatrix * mirrorCoord;\n    vec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n\n#include <beginnormal_vertex>\n#include <defaultnormal_vertex>\n#include <logdepthbuf_vertex>\n#include <fog_vertex>\n#include <shadowmap_vertex>\n}"},8820:(e,o,t)=>{t.r(o),t.d(o,{Water:()=>v});var n=t(660),r=t(2945),a=t(2630),i=t(1615),s=t(1723),l=t(538),c=t(2820),d=t(3212),u=t(4209),m=t(8310),p=t(1364),f=t(9749);class v extends n.e{constructor(e,o={}){super(e),this.isWater=!0;const n=this,v=void 0!==o.textureWidth?o.textureWidth:512,h=void 0!==o.textureHeight?o.textureHeight:512,g=void 0!==o.clipBias?o.clipBias:0,y=void 0!==o.alpha?o.alpha:1,w=void 0!==o.time?o.time:0,M=void 0!==o.waterNormals?o.waterNormals:null,C=void 0!==o.sunDirection?o.sunDirection:new r.P(.70707,.70707,0),x=new a.Q(void 0!==o.sunColor?o.sunColor:16777215),k=new a.Q(void 0!==o.waterColor?o.waterColor:8355711),S=void 0!==o.speed?o.speed:5,D=void 0!==o.eye?o.eye:new r.P(0,0,0),P=void 0!==o.distortionScale?o.distortionScale:20,b=void 0!==o.side?o.side:i.hB5,L=void 0!==o.fog&&o.fog,A=new s.Z,R=new r.P,z=new r.P,E=new r.P,_=new l.k,I=new r.P(0,0,-1),T=new c.I,O=new r.P,B=new r.P,j=new c.I,W=new l.k,F=new d.u,U=new u.n(v,h),K={name:"MirrorShader",uniforms:m.Ll.merge([p.f.fog,p.f.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new l.k},sunColor:{value:new a.Q(8355711)},sunDirection:{value:new r.P(.70707,.70707,0)},eye:{value:new r.P},speed:{value:5},waterColor:{value:new a.Q(5592405)}}]),vertexShader:t(8047).A,fragmentShader:t(5213).A},V=new f.B({name:K.name,uniforms:m.Ll.clone(K.uniforms),vertexShader:K.vertexShader,fragmentShader:K.fragmentShader,lights:!0,side:b,fog:L});V.uniforms.mirrorSampler.value=U.texture,V.uniforms.textureMatrix.value=W,V.uniforms.alpha.value=y,V.uniforms.time.value=w,V.uniforms.normalSampler.value=M,V.uniforms.sunColor.value=x,V.uniforms.waterColor.value=k,V.uniforms.sunDirection.value=C,V.uniforms.distortionScale.value=P,V.uniforms.speed.value=S,V.uniforms.eye.value=D,n.material=V,n.onBeforeRender=function(e,o,t){if(z.setFromMatrixPosition(n.matrixWorld),E.setFromMatrixPosition(t.matrixWorld),_.extractRotation(n.matrixWorld),R.set(0,0,1),R.applyMatrix4(_),O.subVectors(z,E),O.dot(R)>0)return;O.reflect(R).negate(),O.add(z),_.extractRotation(t.matrixWorld),I.set(0,0,-1),I.applyMatrix4(_),I.add(E),B.subVectors(z,I),B.reflect(R).negate(),B.add(z),F.position.copy(O),F.up.set(0,1,0),F.up.applyMatrix4(_),F.up.reflect(R),F.lookAt(B),F.far=t.far,F.updateMatrixWorld(),F.projectionMatrix.copy(t.projectionMatrix),W.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),W.multiply(F.projectionMatrix),W.multiply(F.matrixWorldInverse),A.setFromNormalAndCoplanarPoint(R,z),A.applyMatrix4(F.matrixWorldInverse),T.set(A.normal.x,A.normal.y,A.normal.z,A.constant);const r=F.projectionMatrix;j.x=(Math.sign(T.x)+r.elements[8])/r.elements[0],j.y=(Math.sign(T.y)+r.elements[9])/r.elements[5],j.z=-1,j.w=(1+r.elements[10])/r.elements[14],T.multiplyScalar(2/T.dot(j)),r.elements[2]=T.x,r.elements[6]=T.y,r.elements[10]=T.z+1-g,r.elements[14]=T.w,D.setFromMatrixPosition(t.matrixWorld);const a=e.getRenderTarget(),i=e.xr.enabled,s=e.shadowMap.autoUpdate;n.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(U),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(o,F),n.visible=!0,e.xr.enabled=i,e.shadowMap.autoUpdate=s,e.setRenderTarget(a);const l=t.viewport;void 0!==l&&e.state.viewport(l)}}}},9264:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.hideLevelEndScreen=o.showLevelEndScreen=o.animateCameraFromEndToStartPosition=o.startLevelAnimation=o.uiInit=o.startPanel=o.startButton=o.crystalUiElement=o.countUIclass=void 0;const n=t(5824),r=t(1088),a=t(5968);o.countUIclass=document.getElementById("headsUpDisplay"),o.crystalUiElement=document.getElementById("crystalCount"),o.startButton=document.getElementById("startGame"),o.startPanel=document.getElementById("levelStartPanel");const i=document.getElementById("startOver"),s=document.getElementById("endOfLevel"),l=document.getElementById("crystalCountLevelEnd");o.uiInit=()=>{o.startButton.onclick=e=>{(0,o.hideLevelEndScreen)(),o.countUIclass.classList.remove("hidden"),o.startPanel.classList.add("hidden"),(0,o.startLevelAnimation)(),o.crystalUiElement.innerText=String(r.sceneConfiguration.data.crystalsCollected)}},o.startLevelAnimation=()=>{r.sceneConfiguration.cameraStartAnimationPlaying=!0,r.camera.userData.mixer=new n.AnimationMixer(r.camera);const e=[0,.7,1.4],o=[r.camera.position.x,r.camera.position.y,r.camera.position.z,0,35,110,0,30,100],t=new n.VectorKeyframeTrack(".position",e,o,n.InterpolateSmooth),a=r.camera.quaternion.clone(),i=new n.Quaternion;r.camera.position.x>0?i.setFromAxisAngle(new n.Vector3(0,0,1),.3):i.setFromAxisAngle(new n.Vector3(0,0,1),-.3);const s=(new n.Quaternion).setFromAxisAngle(new n.Vector3(-1,0,0),.3),l=[a.x,a.y,a.z,a.w,i.x,i.y,i.z,i.w,s.x,s.y,s.z,s.w],c=new n.QuaternionKeyframeTrack(".quaternion",e,l,n.InterpolateLinear),d=new n.AnimationClip("animateIn",2,[t,c]),u=r.camera.userData.mixer.clipAction(d);u.setLoop(n.LoopOnce,1),u.clampWhenFinished=!0,r.camera.userData.clock=new n.Clock,r.camera.userData.mixer.addEventListener("finished",(()=>{r.sceneConfiguration.speed=1,r.sceneConfiguration.rocketMoving=!0})),u.play()},o.animateCameraFromEndToStartPosition=()=>{r.sceneConfiguration.cameraStartAnimationPlaying=!0;const e=new n.Vector3(20,30,0);r.camera.userData.mixer=new n.AnimationMixer(r.camera);const o=[0,1.2,2],t=[r.camera.position.x,r.camera.position.y,r.camera.position.z,0,50,-100,e.x,e.y,e.z],i=new n.VectorKeyframeTrack(".position",o,t,n.InterpolateSmooth);let s=a.mothershipModel.position.clone(),l=new n.Quaternion,c=new n.Camera;c.position.copy(e),c.lookAt(s),l.copy(c.quaternion),s=a.rocketModel.position.clone();const d=new n.Quaternion;c.position.copy(e),c.lookAt(s),d.copy(c.quaternion);const u=r.camera.quaternion.clone(),m=[u.x,u.y,u.z,u.w,l.x,l.y,l.z,l.w,d.x,d.y,d.z,d.w],p=new n.QuaternionKeyframeTrack(".quaternion",o,m,n.InterpolateLinear),f=new n.AnimationClip("animateIn",2,[i,p]),v=r.camera.userData.mixer.clipAction(f);v.setLoop(n.LoopOnce,1),v.clampWhenFinished=!0,r.camera.userData.clock=new n.Clock,r.camera.userData.mixer.addEventListener("finished",(()=>{r.sceneConfiguration.cameraStartAnimationPlaying=!1})),v.play()},o.showLevelEndScreen=()=>{o.countUIclass.classList.add("hidden"),s.style.display="flex",s.classList.add("fadeOut"),l.innerText=`Crystals collected: ${r.sceneConfiguration.data.crystalsCollected}`,i.classList.remove("hidden"),i.onclick=()=>{r.sceneConfiguration.levelOver&&!r.sceneConfiguration.rocketMoving&&((0,o.hideLevelEndScreen)(),o.startPanel.classList.remove("hidden"),(0,r.sceneSetup)(!0))}},o.hideLevelEndScreen=()=>{s.style.display="",s.classList.remove("fadeOut"),s.classList.add("hidden"),i.classList.add("hidden"),r.sceneConfiguration.cameraStartAnimationPlaying=!1,r.sceneConfiguration.rocketMoving=!1}},9572:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.updateDestructionBits=o.shakeCamera=o.detectCollisions=o.destructionShield=o.destructionBits=void 0;const n=t(5824),r=t(1088),a=t(5968),i=t(710),s=t(9264);o.destructionBits=new Array,o.destructionShield=null,o.detectCollisions=()=>{if(r.sceneConfiguration.levelOver)return;const e=(new n.Box3).setFromObject(a.rocketModel);a.challengeRows.forEach((o=>{o.rowParent.updateMatrixWorld(),o.rowParent.children.forEach((o=>{o.children.forEach((t=>{const i=(new n.Box3).setFromObject(t);if(i.intersectsBox(e)){let e=i.getCenter(t.position);o.remove(t);let n=o.userData.objectType;if(void 0!==n)switch(n){case a.ObjectType.ROCK:d(e),r.sceneConfiguration.data.shieldsCollected--;break;case a.ObjectType.SHIELD_ITEM:r.sceneConfiguration.data.shieldsCollected++,c(e);break;case a.ObjectType.CRYSTAL:s.crystalUiElement.innerText=String(++r.sceneConfiguration.data.crystalsCollected),l(e)}}}))}))}))};const l=e=>{for(let t=0;t<6;t++){let a=new n.Mesh(new n.SphereGeometry(.3),new n.MeshBasicMaterial({color:"yellow",transparent:!0,opacity:.5}));a.userData.lifetime=0,a.position.copy(e),a.userData.mixer=new n.AnimationMixer(a);let s=t/45,l=15*Math.cos((0,i.radToDeg)(s)),c=15*Math.sin((0,i.radToDeg)(s)),d=new n.VectorKeyframeTrack(".position",[0,.2],[e.x,e.y,e.z,e.x+l,e.y+c,e.z],n.InterpolateSmooth);const u=new n.AnimationClip("animateIn",10,[d]),m=a.userData.mixer.clipAction(u);m.setLoop(n.LoopOnce,1),m.clampWhenFinished=!0,m.play(),a.userData.clock=new n.Clock,r.scene.add(a),o.destructionBits.push(a)}},c=e=>{o.destructionShield&&(r.scene.remove(o.destructionShield),o.destructionShield=null),o.destructionShield=a.shieldModel_transparent.clone(),o.destructionShield.position.copy(a.rocketModel.position),o.destructionShield.scale.set(.1,.1,.1),o.destructionShield.userData.lifetime=0,o.destructionShield.userData.mixer=new n.AnimationMixer(o.destructionShield);let t=new n.VectorKeyframeTrack(".scale",[0,.2],[.1,.1,.1,1,1,1],n.InterpolateSmooth);const i=new n.AnimationClip("animateIn",2,[t]),s=o.destructionShield.userData.mixer.clipAction(i);s.setLoop(n.LoopOnce,1),s.clampWhenFinished=!0,s.play(),o.destructionShield.userData.clock=new n.Clock,r.scene.add(o.destructionShield)},d=e=>{o.destructionShield?(u(),r.scene.remove(o.destructionShield),o.destructionShield=null):((0,o.shakeCamera)(),a.rocketModel.rotation.x+=1,r.sceneConfiguration.levelOver=!0,a.rocketModel.userData.endAnimationLifetime=0,a.rocketModel.userData.clock=new n.Clock,(0,s.showLevelEndScreen)())},u=(e=5,o=200)=>{const t=performance.now(),n=r.camera.position.clone(),a=(r.camera.quaternion.clone(),()=>{performance.now()-t<o&&(r.camera.position.x=n.x+(Math.random()-.5)*e,r.camera.position.y=n.y+(Math.random()-.5)*e,r.camera.position.z=n.z+(Math.random()-.5)*e,r.camera.rotation.x+=(Math.random()-.5)/100,r.camera.rotation.y+=(Math.random()-.5)/100,r.camera.rotation.z+=(Math.random()-.5)/100,requestAnimationFrame(a))});a()};o.shakeCamera=(e=5,o=200)=>{const t=r.sceneConfiguration.dieLeft?1:-1,a=performance.now(),i=r.camera.position.clone(),s=(r.camera.quaternion.clone(),()=>{performance.now()-a<o&&(r.camera.position.x=i.x+(Math.random()-.5)*e,r.camera.position.y=i.y+(Math.random()-.5)*e,r.camera.position.z=i.z+(Math.random()-.5)*e,r.camera.rotation.x+=Math.random()/100,r.camera.rotation.y+=Math.random()/100,r.camera.rotation.z+=t*Math.random()/100,requestAnimationFrame(s))});s(),r.camera.userData.mixer=new n.AnimationMixer(r.camera);const l=[r.camera.position.x,r.camera.position.y,r.camera.position.z,30*t,35,110,10*t,30,100],c=new n.VectorKeyframeTrack(".position",[0,.7,1.4],l,n.InterpolateSmooth),d=new n.AnimationClip("animateIn",1.5,[c]),u=r.camera.userData.mixer.clipAction(d);u.setLoop(n.LoopOnce,1),u.clampWhenFinished=!0,r.camera.userData.clock=new n.Clock,u.play()},o.updateDestructionBits=()=>{for(let e=0;e<o.destructionBits.length;e++){let t=o.destructionBits[e];if(t.userData.lifetime>500)r.scene.remove(t),o.destructionBits.splice(o.destructionBits.indexOf(t),1);else{let e=new n.Vector3;e.copy(a.rocketModel.position),e.sub(t.position),e.normalize();let o=.01*t.userData.lifetime;o=Math.min(o,.8),t.translateOnAxis(e,o),t.userData.lifetime++}}if(o.destructionShield&&(o.destructionShield.userData.lifetime>500?(r.scene.remove(o.destructionShield),o.destructionShield=null):(o.destructionShield.rotateZ(.01),o.destructionShield.position.x=a.rocketModel.position.x,o.destructionShield.userData.lifetime++)),a.rocketModel.position.y<-10&&r.sceneConfiguration.speed>0)r.sceneConfiguration.speed-=.01;else if(a.rocketModel.position.y<-10){r.sceneConfiguration.rocketMoving=!1;let e=a.rocketModel.userData.clock.getElapsedTime();r.sceneConfiguration.speed=0;let o=Math.sin(e);r.camera.position.z+=.01*o,r.camera.position.x+=.01*o}else if(r.sceneConfiguration.levelOver){let e=a.rocketModel.userData.clock.getElapsedTime();const o=10+70*e+-45*e*e;a.rocketModel.position.y=o,a.rocketModel.rotation.z+=.1,a.rocketModel.rotation.x-=.01,r.sceneConfiguration.dieLeft?a.rocketModel.position.x+=.1:a.rocketModel.position.x-=.1,a.rocketModel.userData.endAnimationLifetime++}}}},t={};function n(e){var r=t[e];if(void 0!==r)return r.exports;var a=t[e]={exports:{}};return o[e](a,a.exports,n),a.exports}n.m=o,e=[],n.O=(o,t,r,a)=>{if(!t){var i=1/0;for(d=0;d<e.length;d++){for(var[t,r,a]=e[d],s=!0,l=0;l<t.length;l++)(!1&a||i>=a)&&Object.keys(n.O).every((e=>n.O[e](t[l])))?t.splice(l--,1):(s=!1,a<i&&(i=a));if(s){e.splice(d--,1);var c=r();void 0!==c&&(o=c)}}return o}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[t,r,a]},n.d=(e,o)=>{for(var t in o)n.o(o,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:o[t]})},n.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};n.O.j=o=>0===e[o];var o=(o,t)=>{var r,a,[i,s,l]=t,c=0;if(i.some((o=>0!==e[o]))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(l)var d=l(n)}for(o&&o(t);c<i.length;c++)a=i[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(d)},t=self.webpackChunk=self.webpackChunk||[];t.forEach(o.bind(null,0)),t.push=o.bind(null,t.push.bind(t))})();var r=n.O(void 0,[291],(()=>n(1088)));r=n.O(r)})();