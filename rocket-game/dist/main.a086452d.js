(()=>{"use strict";var e,t={29:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clamp=t.onKeyUp=t.onKeyDown=t.sensibility=void 0;const n=o(1088);t.sensibility=.8,t.onKeyDown=function(e){let t=e.code||e.key;"ArrowLeft"===t||"KeyA"===t?n.sceneConfiguration.leftPressed=!0:"ArrowRight"!==t&&"KeyD"!==t||(n.sceneConfiguration.rightPressed=!0)},t.onKeyUp=function(e){let t=e.code||e.key;"ArrowLeft"===t||"KeyA"===t?n.sceneConfiguration.leftPressed=!1:"ArrowRight"!==t&&"KeyD"!==t||(n.sceneConfiguration.rightPressed=!1)},t.clamp=(e,t,o)=>Math.min(Math.max(e,t),o)},1088:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sceneSetup=t.sceneConfiguration=t.water=t.waterGeometry=t.camera=t.scene=void 0;const n=o(5824),i=o(8509),r=o(5968),a=o(9264),s=o(29),l=o(9572),c=o(8820);t.scene=new n.Scene,t.camera=new n.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,2e3);const d=new n.Vector3;let u,m=0;t.waterGeometry=new n.PlaneGeometry(1e4,1e4),t.water=new c.Water(t.waterGeometry,{textureWidth:512,textureHeight:512,waterNormals:(new n.TextureLoader).load("static/normals/waternormals.jpeg",(function(e){e.wrapS=e.wrapT=n.MirroredRepeatWrapping})),sunDirection:new n.Vector3,sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:void 0!==t.scene.fog}),t.sceneConfiguration={ready:!1,cameraMovingToStartPosition:!1,rocketMoving:!1,data:{crystalsCollected:0,shieldsCollected:0},courseProgress:0,levelOver:!1,level:1,cameraStartAnimationPlaying:!1,backgroundRockCount:0,challengeRowCount:0,speed:0,dieLeft:Math.random()>.5,starterBayInScene:!1,leftPressed:!1,rightPressed:!1},t.sceneSetup=e=>{m=0,t.sceneConfiguration.challengeRowCount=0,t.sceneConfiguration.backgroundRockCount=0,t.scene.add(r.starterBay),t.sceneConfiguration.starterBayInScene=!0,r.starterBay.position.copy(new n.Vector3(10,0,120)),r.rocketModel.rotation.x=Math.PI,r.rocketModel.rotation.z=0,r.rocketModel.position.z=70,r.rocketModel.position.y=10,r.rocketModel.position.x=0,r.challengeRows.forEach((e=>{t.scene.remove(e.rowParent)})),r.environmentRocks.forEach((e=>{t.scene.remove(e)})),r.environmentRocks.length=0,r.challengeRows.length=0;for(let e=0;e<60;e++)(0,r.addChallengeRow)(t.sceneConfiguration.challengeRowCount++),(0,r.addBackgroundRock)(t.sceneConfiguration.backgroundRockCount++);t.sceneConfiguration.cameraStartAnimationPlaying=!1,t.sceneConfiguration.levelOver=!1,r.rocketModel.userData.flyingAway=!1,t.sceneConfiguration.courseProgress=0,t.sceneConfiguration.data.shieldsCollected=0,t.sceneConfiguration.data.crystalsCollected=0,a.crystalUiElement.innerText=String(t.sceneConfiguration.data.crystalsCollected),e?(0,a.animateCameraFromEndToStartPosition)():(t.camera.position.z=50,t.camera.position.y=12,t.camera.position.x=15,t.camera.rotation.y=2.5),t.sceneConfiguration.ready=!0};const p=()=>{var e,o,i,a,c,d,f,v;if(requestAnimationFrame(p),t.sceneConfiguration.ready){if(null===(o=null===(e=r.rocketModel.userData)||void 0===e?void 0:e.mixer)||void 0===o||o.update(r.rocketModel.userData.clock.getDelta()),null===(a=null===(i=t.camera.userData)||void 0===i?void 0:i.mixer)||void 0===a||a.update(null===(d=null===(c=t.camera.userData)||void 0===c?void 0:c.clock)||void 0===d?void 0:d.getDelta()),l.destructionBits.forEach((e=>{var t;null===(t=e.userData.mixer)||void 0===t||t.update(e.userData.clock.getDelta())})),null===(v=null===(f=null===l.destructionShield||void 0===l.destructionShield?void 0:l.destructionShield.userData)||void 0===f?void 0:f.mixer)||void 0===v||v.update(l.destructionShield.userData.clock.getDelta()),t.sceneConfiguration.cameraStartAnimationPlaying||(t.camera.position.x=20*Math.cos(m),t.camera.position.z=20*Math.sin(m),t.camera.position.y=30,t.camera.lookAt(r.rocketModel.position),m+=.005),t.sceneConfiguration.rocketMoving&&!t.sceneConfiguration.levelOver){let e=0,o=0;t.sceneConfiguration.leftPressed&&(e-=s.sensibility,o-=Math.PI/4),t.sceneConfiguration.rightPressed&&(e+=s.sensibility,o+=Math.PI/4),r.rocketModel.position.x+=e,r.rocketModel.position.x=(0,s.clamp)(r.rocketModel.position.x,-20,25),o=-20===r.rocketModel.position.x||25===r.rocketModel.position.x?0:o,r.rocketModel.rotation.z=n.MathUtils.lerp(r.rocketModel.rotation.z,o,.1),t.sceneConfiguration.speed+=.001,t.sceneConfiguration.speed=(0,s.clamp)(t.sceneConfiguration.speed,0,10),t.sceneConfiguration.courseProgress+=t.sceneConfiguration.speed,(0,l.detectCollisions)()}(0,r.objectsMotionUpdate)()}(0,l.updateDestructionBits)(),(0,r.updateWaterMaterial)(),u.render(t.scene,t.camera)};(0,r.objectsInit)().then((e=>{(0,a.uiInit)(),async function(){var e,o,l;u=new n.WebGLRenderer,u.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(u.domElement),a.startPanel.classList.remove("hidden"),document.addEventListener("keydown",s.onKeyDown,!1),document.addEventListener("keyup",s.onKeyUp,!1),null===(e=document.getElementById("loadingCover"))||void 0===e||e.remove(),null===(o=document.getElementById("loadingTextContainer"))||void 0===o||o.remove(),null===(l=document.getElementById("rocketPicture"))||void 0===l||l.remove(),t.water.rotation.x=-Math.PI/2,t.water.rotation.z=0,t.scene.add(t.water);const c=new i.Sky;c.scale.setScalar(1e4),t.scene.add(c);const m=c.material.uniforms;m.turbidity.value=10,m.rayleigh.value=2,m.mieCoefficient.value=.005,m.mieDirectionalG.value=.8;const p=new n.PMREMGenerator(u),f=n.MathUtils.degToRad(87),v=n.MathUtils.degToRad(115);d.setFromSphericalCoords(1,f,v),c.material.uniforms.sunPosition.value.copy(d),t.water.material.uniforms.sunDirection.value.copy(d).normalize(),t.scene.environment=p.fromScene(c).texture,t.water.material.uniforms.speed.value=0,r.rocketModel.scale.set(.3,.3,.3),t.scene.add(r.rocketModel),t.scene.add(r.mothershipModel),r.mothershipModel.position.y=200,r.mothershipModel.position.z=100,r.mothershipModel.scale.set(15,15,15)}(),(0,t.sceneSetup)(!1),p()}))},5213:(e,t,o)=>{o.d(t,{A:()=>n});const n="uniform sampler2D mirrorSampler;\nuniform float alpha;\nuniform float time;\nuniform float size;\nuniform float distortionScale;\nuniform float speed;\nuniform sampler2D normalSampler;\nuniform vec3 sunColor;\nuniform vec3 sunDirection;\nuniform vec3 eye;\nuniform vec3 waterColor;\n\nvarying vec4 mirrorCoord;\nvarying vec4 worldPosition;\n\nvec4 getNoise( vec2 uv ) {\n    float offset;\n    if ( speed == 0.0 ) {\n        offset = time / 10.0;\n    } else {\n        offset = speed;\n    }\n\n    // vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);\n    // vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );\n    // vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );\n    // vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );\n    vec2 uv3 = uv / vec2(50.0, 50.0) - vec2(speed / 1000.0, offset);\n    vec2 uv0 = vec2(0, 0);\n    vec2 uv1 = vec2(0, 0);\n    vec2 uv2 = vec2(0, 0);\n    \n    vec4 noise = texture2D( normalSampler, uv0 ) +\n        texture2D( normalSampler, uv1 ) +\n        texture2D( normalSampler, uv2 ) +\n        texture2D( normalSampler, uv3 );\n    return noise * 0.5 - 1.0;\n}\n\nvoid sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {\n    vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );\n    float direction = max( 0.0, dot( eyeDirection, reflection ) );\n    specularColor += pow( direction, shiny ) * sunColor * spec;\n    diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;\n}\n\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n    #include <logdepthbuf_fragment>\n    vec4 noise = getNoise( worldPosition.xz * size );\n    vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );\n\n    vec3 diffuseLight = vec3(0.0);\n    vec3 specularLight = vec3(0.0);\n\n    vec3 worldToEye = eye-worldPosition.xyz;\n    vec3 eyeDirection = normalize( worldToEye );\n    sunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );\n\n    float distance = length(worldToEye);\n\n    vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;\n    vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );\n\n    float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );\n    float rf0 = 0.3;\n    float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );\n    vec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;\n    vec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);\n    vec3 outgoingLight = albedo;\n    gl_FragColor = vec4( outgoingLight, alpha );\n\n    #include <tonemapping_fragment>\n    // #include <colorspace_fragment>\n    #include <fog_fragment>\t\n}"},5968:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectType=t.addChallengeRow=t.addBackgroundRock=t.updateWaterMaterial=t.objectsMotionUpdate=t.objectsInit=t.shieldModel_transparent=t.shieldModel=t.rockModel=t.crystalModel=t.cliffsModel=t.mothershipModel=t.starterBay=t.rocketModel=t.challengeRows=t.environmentRocks=void 0;const n=o(5824),i=o(1088),r=o(7888);t.environmentRocks=new Array,t.challengeRows=new Array;const a=new r.GLTFLoader;t.objectsInit=async()=>{t.cliffsModel=(await a.loadAsync("static/models/cliffs/scene.gltf")).scene.children[0],t.crystalModel=(await a.loadAsync("static/models/glowing_crystals/scene.gltf")).scene.children[0],t.rockModel=(await a.loadAsync("static/models/glowing_rock/scene.gltf")).scene.children[0],t.shieldModel=(await a.loadAsync("static/models/shield_item/scene.gltf")).scene.children[0],t.rocketModel=(await a.loadAsync("static/models/rocket/scene.gltf")).scene.children[0],t.starterBay=(await a.loadAsync("static/models/start_bay/scene.gltf")).scene,t.mothershipModel=(await a.loadAsync("static/models/spaceship_nortend/scene.gltf")).scene,t.shieldModel_transparent=t.shieldModel.clone(),t.shieldModel_transparent.traverse((e=>{if(e instanceof n.Mesh){const t=e.material;if(t&&"transparent"in t&&"Material.001"!==t.name){e.material=t.clone();const o=e.material;o.transparent=!0,o.opacity=.2}else e.parent&&e.parent.remove(e)}}))},t.objectsMotionUpdate=()=>{t.environmentRocks.forEach((e=>{e.position.z+=i.sceneConfiguration.speed})),t.environmentRocks[0].position.z>-1300&&(0,t.addBackgroundRock)(i.sceneConfiguration.backgroundRockCount++,!0),t.challengeRows.forEach((e=>{e.rowParent.position.z+=i.sceneConfiguration.speed})),t.challengeRows[0].rowParent.position.z>-1300&&(0,t.addChallengeRow)(i.sceneConfiguration.challengeRowCount++,!0),i.sceneConfiguration.starterBayInScene&&(t.starterBay.position.z+=i.sceneConfiguration.speed,t.starterBay.position.z>200&&(i.scene.remove(t.starterBay),i.sceneConfiguration.starterBayInScene=!1))},t.updateWaterMaterial=function(){i.water.material.uniforms.time.value+=1/60,i.sceneConfiguration.rocketMoving?i.water.material.uniforms.speed.value+=i.sceneConfiguration.speed/50:i.water.material.uniforms.speed.value>0&&(i.water.material.uniforms.speed.value-=.001)},t.addBackgroundRock=(e,o=!1)=>{let r=o?-1400:-60*e,a=t.cliffsModel.clone();a.scale.set(.02,.02,.02),a.position.set(e%2==0?60-Math.random():-60-Math.random(),0,r),a.rotation.set(n.MathUtils.degToRad(-90),0,Math.random()),i.scene.add(a),t.environmentRocks.unshift(a)},t.addChallengeRow=(e,o=!1)=>{let r=o?-1400:-60*e,a=new n.Group;a.position.z=r;for(let e=0;e<5;e++){const t=10*Math.random();if(t<2){let t=s(e);a.add(t)}else if(t<4){let t=l(e);a.add(t)}else if(t>9){let t=c(e);a.add(t)}}t.challengeRows.unshift({rowParent:a,index:i.sceneConfiguration.challengeRowCount++}),i.scene.add(a)};const s=e=>{let o=t.crystalModel.clone();return o.position.x=11*e-20,o.scale.set(.02,.02,.02),o.userData.objectType=d.CRYSTAL,o},l=e=>{let o=t.rockModel.clone();return o.position.x=11*e-20,o.scale.set(5,5,5),o.position.setY(5),o.userData.objectType=d.ROCK,o},c=e=>{let o=t.shieldModel.clone();return o.position.x=11*e-20,o.position.y=8,o.userData.objectType=d.SHIELD_ITEM,o};var d;!function(e){e[e.ROCK=0]="ROCK",e[e.CRYSTAL=1]="CRYSTAL",e[e.SHIELD_ITEM=2]="SHIELD_ITEM"}(d=t.ObjectType||(t.ObjectType={}))},8047:(e,t,o)=>{o.d(t,{A:()=>n});const n="uniform mat4 textureMatrix;\nuniform float time;\n\nvarying vec4 mirrorCoord;\nvarying vec4 worldPosition;\n\n#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n\nvoid main() {\n    mirrorCoord = modelMatrix * vec4( position, 1.0 );\n    worldPosition = mirrorCoord.xyzw;\n    mirrorCoord = textureMatrix * mirrorCoord;\n    vec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n\n#include <beginnormal_vertex>\n#include <defaultnormal_vertex>\n#include <logdepthbuf_vertex>\n#include <fog_vertex>\n#include <shadowmap_vertex>\n}"},8820:(e,t,o)=>{o.r(t),o.d(t,{Water:()=>v});var n=o(660),i=o(2945),r=o(2630),a=o(1615),s=o(1723),l=o(538),c=o(2820),d=o(3212),u=o(4209),m=o(8310),p=o(1364),f=o(9749);class v extends n.e{constructor(e,t={}){super(e),this.isWater=!0;const n=this,v=void 0!==t.textureWidth?t.textureWidth:512,h=void 0!==t.textureHeight?t.textureHeight:512,g=void 0!==t.clipBias?t.clipBias:0,y=void 0!==t.alpha?t.alpha:1,w=void 0!==t.time?t.time:0,C=void 0!==t.waterNormals?t.waterNormals:null,x=void 0!==t.sunDirection?t.sunDirection:new i.P(.70707,.70707,0),M=new r.Q(void 0!==t.sunColor?t.sunColor:16777215),k=new r.Q(void 0!==t.waterColor?t.waterColor:8355711),S=void 0!==t.speed?t.speed:5,D=void 0!==t.eye?t.eye:new i.P(0,0,0),P=void 0!==t.distortionScale?t.distortionScale:20,L=void 0!==t.side?t.side:a.hB5,b=void 0!==t.fog&&t.fog,A=new s.Z,E=new i.P,R=new i.P,I=new i.P,T=new l.k,_=new i.P(0,0,-1),z=new c.I,B=new i.P,O=new i.P,j=new c.I,W=new l.k,U=new d.u,F=new u.n(v,h),K={name:"MirrorShader",uniforms:m.Ll.merge([p.f.fog,p.f.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new l.k},sunColor:{value:new r.Q(8355711)},sunDirection:{value:new i.P(.70707,.70707,0)},eye:{value:new i.P},speed:{value:5},waterColor:{value:new r.Q(5592405)}}]),vertexShader:o(8047).A,fragmentShader:o(5213).A},V=new f.B({name:K.name,uniforms:m.Ll.clone(K.uniforms),vertexShader:K.vertexShader,fragmentShader:K.fragmentShader,lights:!0,side:L,fog:b});V.uniforms.mirrorSampler.value=F.texture,V.uniforms.textureMatrix.value=W,V.uniforms.alpha.value=y,V.uniforms.time.value=w,V.uniforms.normalSampler.value=C,V.uniforms.sunColor.value=M,V.uniforms.waterColor.value=k,V.uniforms.sunDirection.value=x,V.uniforms.distortionScale.value=P,V.uniforms.speed.value=S,V.uniforms.eye.value=D,n.material=V,n.onBeforeRender=function(e,t,o){if(R.setFromMatrixPosition(n.matrixWorld),I.setFromMatrixPosition(o.matrixWorld),T.extractRotation(n.matrixWorld),E.set(0,0,1),E.applyMatrix4(T),B.subVectors(R,I),B.dot(E)>0)return;B.reflect(E).negate(),B.add(R),T.extractRotation(o.matrixWorld),_.set(0,0,-1),_.applyMatrix4(T),_.add(I),O.subVectors(R,_),O.reflect(E).negate(),O.add(R),U.position.copy(B),U.up.set(0,1,0),U.up.applyMatrix4(T),U.up.reflect(E),U.lookAt(O),U.far=o.far,U.updateMatrixWorld(),U.projectionMatrix.copy(o.projectionMatrix),W.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),W.multiply(U.projectionMatrix),W.multiply(U.matrixWorldInverse),A.setFromNormalAndCoplanarPoint(E,R),A.applyMatrix4(U.matrixWorldInverse),z.set(A.normal.x,A.normal.y,A.normal.z,A.constant);const i=U.projectionMatrix;j.x=(Math.sign(z.x)+i.elements[8])/i.elements[0],j.y=(Math.sign(z.y)+i.elements[9])/i.elements[5],j.z=-1,j.w=(1+i.elements[10])/i.elements[14],z.multiplyScalar(2/z.dot(j)),i.elements[2]=z.x,i.elements[6]=z.y,i.elements[10]=z.z+1-g,i.elements[14]=z.w,D.setFromMatrixPosition(o.matrixWorld);const r=e.getRenderTarget(),a=e.xr.enabled,s=e.shadowMap.autoUpdate;n.visible=!1,e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(F),e.state.buffers.depth.setMask(!0),!1===e.autoClear&&e.clear(),e.render(t,U),n.visible=!0,e.xr.enabled=a,e.shadowMap.autoUpdate=s,e.setRenderTarget(r);const l=o.viewport;void 0!==l&&e.state.viewport(l)}}}},9264:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hideLevelEndScreen=t.showLevelEndScreen=t.animateCameraFromEndToStartPosition=t.startLevelAnimation=t.uiInit=t.startPanel=t.startButton=t.crystalUiElement=t.countUIclass=void 0;const n=o(5824),i=o(1088),r=o(5968);t.countUIclass=document.getElementById("headsUpDisplay"),t.crystalUiElement=document.getElementById("crystalCount"),t.startButton=document.getElementById("startGame"),t.startPanel=document.getElementById("levelStartPanel");const a=document.getElementById("startOver"),s=document.getElementById("endOfLevel"),l=document.getElementById("crystalCountLevelEnd");t.uiInit=()=>{t.startButton.onclick=e=>{(0,t.hideLevelEndScreen)(),t.countUIclass.classList.remove("hidden"),t.startPanel.classList.add("hidden"),(0,t.startLevelAnimation)(),t.crystalUiElement.innerText=String(i.sceneConfiguration.data.crystalsCollected)}},t.startLevelAnimation=()=>{i.sceneConfiguration.cameraStartAnimationPlaying=!0,i.camera.userData.mixer=new n.AnimationMixer(i.camera);const e=[0,.7,1.4],t=[i.camera.position.x,i.camera.position.y,i.camera.position.z,0,35,110,0,30,100],o=new n.VectorKeyframeTrack(".position",e,t,n.InterpolateSmooth),r=i.camera.quaternion.clone(),a=new n.Quaternion;i.camera.position.x>0?a.setFromAxisAngle(new n.Vector3(0,0,1),.3):a.setFromAxisAngle(new n.Vector3(0,0,1),-.3);const s=(new n.Quaternion).setFromAxisAngle(new n.Vector3(-1,0,0),.3),l=[r.x,r.y,r.z,r.w,a.x,a.y,a.z,a.w,s.x,s.y,s.z,s.w],c=new n.QuaternionKeyframeTrack(".quaternion",e,l,n.InterpolateLinear),d=new n.AnimationClip("animateIn",2,[o,c]),u=i.camera.userData.mixer.clipAction(d);u.setLoop(n.LoopOnce,1),u.clampWhenFinished=!0,i.camera.userData.clock=new n.Clock,i.camera.userData.mixer.addEventListener("finished",(()=>{i.sceneConfiguration.speed=1,i.sceneConfiguration.rocketMoving=!0})),u.play()},t.animateCameraFromEndToStartPosition=()=>{i.sceneConfiguration.cameraStartAnimationPlaying=!0;const e=new n.Vector3(20,30,0);i.camera.userData.mixer=new n.AnimationMixer(i.camera);const t=[0,1.2,2],o=[i.camera.position.x,i.camera.position.y,i.camera.position.z,0,50,-100,e.x,e.y,e.z],a=new n.VectorKeyframeTrack(".position",t,o,n.InterpolateSmooth);let s=r.mothershipModel.position.clone(),l=new n.Quaternion,c=new n.Camera;c.position.copy(e),c.lookAt(s),l.copy(c.quaternion),s=r.rocketModel.position.clone();const d=new n.Quaternion;c.position.copy(e),c.lookAt(s),d.copy(c.quaternion);const u=i.camera.quaternion.clone(),m=[u.x,u.y,u.z,u.w,l.x,l.y,l.z,l.w,d.x,d.y,d.z,d.w],p=new n.QuaternionKeyframeTrack(".quaternion",t,m,n.InterpolateLinear),f=new n.AnimationClip("animateIn",2,[a,p]),v=i.camera.userData.mixer.clipAction(f);v.setLoop(n.LoopOnce,1),v.clampWhenFinished=!0,i.camera.userData.clock=new n.Clock,i.camera.userData.mixer.addEventListener("finished",(()=>{i.sceneConfiguration.cameraStartAnimationPlaying=!1})),v.play()},t.showLevelEndScreen=()=>{t.countUIclass.classList.add("hidden"),s.style.display="flex",s.classList.add("fadeOut"),l.innerText=`Crystals collected: ${i.sceneConfiguration.data.crystalsCollected}`,a.classList.remove("hidden"),a.onclick=()=>{i.sceneConfiguration.levelOver&&!i.sceneConfiguration.rocketMoving&&((0,t.hideLevelEndScreen)(),t.startPanel.classList.remove("hidden"),(0,i.sceneSetup)(!0))}},t.hideLevelEndScreen=()=>{s.style.display="",s.classList.remove("fadeOut"),s.classList.add("hidden"),a.classList.add("hidden"),i.sceneConfiguration.cameraStartAnimationPlaying=!1,i.sceneConfiguration.rocketMoving=!1}},9572:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateDestructionBits=t.shakeCamera=t.detectCollisions=t.destructionShield=t.destructionBits=void 0;const n=o(5824),i=o(1088),r=o(5968),a=o(710),s=o(9264);t.destructionBits=new Array,t.destructionShield=null,t.detectCollisions=()=>{if(i.sceneConfiguration.levelOver)return;const e=(new n.Box3).setFromObject(r.rocketModel);r.challengeRows.forEach((t=>{t.rowParent.updateMatrixWorld(),t.rowParent.children.forEach((t=>{t.children.forEach((o=>{const a=(new n.Box3).setFromObject(o);if(a.intersectsBox(e)){let e=a.getCenter(o.position);t.remove(o);let n=t.userData.objectType;if(void 0!==n)switch(n){case r.ObjectType.ROCK:d(e),i.sceneConfiguration.data.shieldsCollected--;break;case r.ObjectType.SHIELD_ITEM:i.sceneConfiguration.data.shieldsCollected++,c(e);break;case r.ObjectType.CRYSTAL:s.crystalUiElement.innerText=String(++i.sceneConfiguration.data.crystalsCollected),l(e)}}}))}))}))};const l=e=>{for(let o=0;o<6;o++){let r=new n.Mesh(new n.SphereGeometry(.3),new n.MeshBasicMaterial({color:"yellow",transparent:!0,opacity:.5}));r.userData.lifetime=0,r.position.copy(e),r.userData.mixer=new n.AnimationMixer(r);let s=o/45,l=15*Math.cos((0,a.radToDeg)(s)),c=15*Math.sin((0,a.radToDeg)(s)),d=new n.VectorKeyframeTrack(".position",[0,.2],[e.x,e.y,e.z,e.x+l,e.y+c,e.z],n.InterpolateSmooth);const u=new n.AnimationClip("animateIn",10,[d]),m=r.userData.mixer.clipAction(u);m.setLoop(n.LoopOnce,1),m.clampWhenFinished=!0,m.play(),r.userData.clock=new n.Clock,i.scene.add(r),t.destructionBits.push(r)}},c=e=>{t.destructionShield&&(i.scene.remove(t.destructionShield),t.destructionShield=null),t.destructionShield=r.shieldModel_transparent.clone(),t.destructionShield.position.copy(r.rocketModel.position),t.destructionShield.scale.set(.1,.1,.1),t.destructionShield.userData.lifetime=0,t.destructionShield.userData.mixer=new n.AnimationMixer(t.destructionShield);let o=new n.VectorKeyframeTrack(".scale",[0,.2],[.1,.1,.1,1,1,1],n.InterpolateSmooth);const a=new n.AnimationClip("animateIn",2,[o]),s=t.destructionShield.userData.mixer.clipAction(a);s.setLoop(n.LoopOnce,1),s.clampWhenFinished=!0,s.play(),t.destructionShield.userData.clock=new n.Clock,i.scene.add(t.destructionShield)},d=e=>{t.destructionShield?(i.scene.remove(t.destructionShield),t.destructionShield=null):((0,t.shakeCamera)(),r.rocketModel.rotation.x+=1,i.sceneConfiguration.levelOver=!0,r.rocketModel.userData.endAnimationLifetime=0,r.rocketModel.userData.clock=new n.Clock,(0,s.showLevelEndScreen)())};t.shakeCamera=(e=5,t=200)=>{const o=performance.now(),r=i.camera.position.clone(),a=()=>{performance.now()-o<t&&(i.camera.position.x=r.x+(Math.random()-.5)*e,i.camera.position.y=r.y+(Math.random()-.5)*e,i.camera.position.z=r.z+(Math.random()-.5)*e,i.camera.rotation.x+=Math.random()/100,i.camera.rotation.y+=Math.random()/100,i.camera.rotation.z+=Math.random()/100,requestAnimationFrame(a))};a(),i.camera.userData.mixer=new n.AnimationMixer(i.camera);const s=i.sceneConfiguration.dieLeft?1:-1,l=[i.camera.position.x,i.camera.position.y,i.camera.position.z,30*s,35,110,10*s,30,100],c=new n.VectorKeyframeTrack(".position",[0,.7,1.4],l,n.InterpolateSmooth),d=new n.AnimationClip("animateIn",1.5,[c]),u=i.camera.userData.mixer.clipAction(d);u.setLoop(n.LoopOnce,1),u.clampWhenFinished=!0,i.camera.userData.clock=new n.Clock,i.camera.userData.mixer.addEventListener("finished",(()=>{})),u.play()},t.updateDestructionBits=()=>{for(let e=0;e<t.destructionBits.length;e++){let o=t.destructionBits[e];if(o.userData.lifetime>500)i.scene.remove(o),t.destructionBits.splice(t.destructionBits.indexOf(o),1);else{let e=new n.Vector3;e.copy(r.rocketModel.position),e.sub(o.position),e.normalize();let t=.01*o.userData.lifetime;t=Math.min(t,.8),o.translateOnAxis(e,t),o.userData.lifetime++}}if(t.destructionShield&&(t.destructionShield.userData.lifetime>500?(i.scene.remove(t.destructionShield),t.destructionShield=null):(t.destructionShield.rotateZ(.01),t.destructionShield.position.x=r.rocketModel.position.x,t.destructionShield.userData.lifetime++)),r.rocketModel.position.y<-10&&i.sceneConfiguration.speed>0)i.sceneConfiguration.speed-=.01;else if(r.rocketModel.position.y<-10){i.sceneConfiguration.rocketMoving=!1;let e=r.rocketModel.userData.clock.getElapsedTime();i.sceneConfiguration.speed=0;let t=Math.sin(e);i.camera.position.z+=.01*t,i.camera.position.x+=.01*t}else if(i.sceneConfiguration.levelOver){let e=r.rocketModel.userData.clock.getElapsedTime();const t=10+70*e+-45*e*e;r.rocketModel.position.y=t,r.rocketModel.rotation.z+=.1,r.rocketModel.rotation.x-=.01,i.sceneConfiguration.dieLeft?r.rocketModel.position.x+=.1:r.rocketModel.position.x-=.1,r.rocketModel.userData.endAnimationLifetime++}}}},o={};function n(e){var i=o[e];if(void 0!==i)return i.exports;var r=o[e]={exports:{}};return t[e](r,r.exports,n),r.exports}n.m=t,e=[],n.O=(t,o,i,r)=>{if(!o){var a=1/0;for(d=0;d<e.length;d++){for(var[o,i,r]=e[d],s=!0,l=0;l<o.length;l++)(!1&r||a>=r)&&Object.keys(n.O).every((e=>n.O[e](o[l])))?o.splice(l--,1):(s=!1,r<a&&(a=r));if(s){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[o,i,r]},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};n.O.j=t=>0===e[t];var t=(t,o)=>{var i,r,[a,s,l]=o,c=0;if(a.some((t=>0!==e[t]))){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(l)var d=l(n)}for(t&&t(o);c<a.length;c++)r=a[c],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},o=self.webpackChunk=self.webpackChunk||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var i=n.O(void 0,[291],(()=>n(1088)));i=n.O(i)})();